
# é¢è¯•é¢˜ 12




## ç›®å½•
<!-- toc -->
 ## 1. ä¸‹é¢å‡½æ•°çš„æ‰§è¡Œæƒ…å†µ 

```javascript hl:3
var b = 10;
(function b() {
  // åœ¨å…·åå‡½æ•°è¡¨è¾¾å¼ä¸­ï¼Œå‡½æ•°åæ ‡è¯†ç¬¦åœ¨å‡½æ•°å†…éƒ¨æ˜¯åªè¯»çš„ï¼ˆread-onlyï¼‰
  // ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ¥é”™ // TypeError: Assignment to constant variable
  // æ‰€ä»¥è¿™é‡Œä¿®æ”¹ b çš„å€¼æ˜¯æ— æ•ˆçš„
  b = 20;
  console.log(b);
});

console.log(b); // 10
```

![å›¾ç‰‡&æ–‡ä»¶](./files/20241111-52.png)

### 1.1. ä¸¥æ ¼æ¨¡å¼ä¸‹çš„è¡Œä¸º

åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå°è¯•ä¿®æ”¹åªè¯»æ ‡è¯†ç¬¦ä¼šæŠ›å‡ºé”™è¯¯ï¼š

```javascript
var b = 10;
(function b() {
    'use strict';
    b = 20;  // TypeError: Assignment to constant variable
    console.log(b);
})();
```

### 1.2. ä½¿ç”¨ä¸åŒçš„å˜é‡å

```javascript
var b = 10;
(function c() {
    b = 20;
    console.log(b);  // è¾“å‡º 20
})();
console.log(b);  // è¾“å‡º 20
```

### 1.3. åœ¨å‡½æ•°å†…éƒ¨å£°æ˜åŒåå˜é‡

```javascript hl:3
var b = 10;
(function b() {
    var b = 20;  // åˆ›å»ºæ–°çš„å±€éƒ¨å˜é‡
    console.log(b);  // è¾“å‡º 20
})();
console.log(b);  // è¾“å‡º 10
```

## 2. è¯·ç®€è¿° Reflect ä½œç”¨

Reflect æ˜¯ ES6 (ECMAScript 2015) å¼•å…¥çš„ä¸€ä¸ªæ–°çš„å…¨å±€å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ç»„æ–¹æ³•æ¥æ“ä½œå¯¹è±¡ã€‚Reflect çš„ä¸»è¦ä½œç”¨å¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹ï¼š

### 2.1. ç»Ÿä¸€æ“ä½œå¯¹è±¡çš„ API

Reflect æä¾›äº†ä¸€å¥—ç»Ÿä¸€çš„æ–¹æ³•æ¥æ‰§è¡Œ JavaScript å¯¹è±¡çš„å¸¸è§æ“ä½œï¼Œå¦‚å±æ€§çš„è¯»å–ã€è®¾ç½®ã€åˆ é™¤ç­‰ã€‚è¿™äº›æ–¹æ³•ä¸å¯¹åº”çš„ Object æ–¹æ³•ç›¸ä¼¼ï¼Œä½†æ›´åŠ è§„èŒƒåŒ–å’ŒåŠŸèƒ½ç»Ÿä¸€ã€‚

### 2.2. ç®€åŒ–ä»£ç†ï¼ˆProxyï¼‰çš„åˆ›å»º

Reflect çš„æ–¹æ³•ä¸ Proxy çš„å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œä½¿å¾—åœ¨å®ç°ä»£ç†æ—¶æ›´åŠ æ–¹ä¾¿å’Œç›´è§‚ã€‚

### 2.3. æä¾›å‡½æ•°å¼ç¼–ç¨‹é£æ ¼çš„å¯¹è±¡æ“ä½œ
Reflect çš„æ–¹æ³•éƒ½æ˜¯å‡½æ•°ï¼Œå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œæœ‰åˆ©äºå‡½æ•°å¼ç¼–ç¨‹ã€‚

### 2.4. æ›¿ä»£ä¸€äº› Object çš„æ–¹æ³•

æŸäº› Object ä¸Šçš„æ–¹æ³•åœ¨ Reflect ä¸­æœ‰å¯¹åº”çš„ã€æ›´åˆç†çš„å®ç°ã€‚

### 2.5. è¿”å›æ›´åˆç†çš„ç»“æœ

æŸäº›æ“ä½œï¼ˆå¦‚ definePropertyï¼‰åœ¨ Reflect ä¸­ä¼šè¿”å›å¸ƒå°”å€¼è¡¨ç¤ºæˆåŠŸä¸å¦ï¼Œè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚

è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ä¾‹å­æ¥å…·ä½“è¯´æ˜ Reflect çš„ä½œç”¨ï¼š

```javascript
// 1. è·å–å±æ€§
const obj = { x: 1, y: 2 };
console.log(Reflect.get(obj, 'x')); // 1

// 2. è®¾ç½®å±æ€§
Reflect.set(obj, 'z', 3);
console.log(obj); // { x: 1, y: 2, z: 3 }

// 3. åˆ é™¤å±æ€§
Reflect.deleteProperty(obj, 'y');
console.log(obj); // { x: 1, z: 3 }

// 4. æ£€æŸ¥å¯¹è±¡æ˜¯å¦æœ‰æŸä¸ªå±æ€§
console.log(Reflect.has(obj, 'x')); // true

// 5. è·å–å¯¹è±¡çš„æ‰€æœ‰å±æ€§
console.log(Reflect.ownKeys(obj)); // ['x', 'z']

// 6. åˆ›å»ºæ–°å¯¹è±¡
const newObj = Reflect.construct(function(a, b) {
  this.sum = a + b;
}, [1, 2]);
console.log(newObj.sum); // 3

// 7. è°ƒç”¨å‡½æ•°å¹¶æŒ‡å®š this
function greet() {
  return `Hello, ${this.name}!`;
}
console.log(Reflect.apply(greet, { name: 'Alice' }, [])); // "Hello, Alice!"

// 8. å®šä¹‰æ–°å±æ€§
Reflect.defineProperty(obj, 'w', {
  value: 4,
  writable: true,
  enumerable: true,
  configurable: true
});
console.log(obj.w); // 4
```

### 2.6. å…¶ä»–

1. Reflect ä¸»è¦ç”¨äºæ“ä½œæ™®é€šå¯¹è±¡ï¼Œä¸ç›´æ¥æ”¯æŒ Mapã€Set ç­‰é›†åˆç±»å‹
2. Map ç­‰é›†åˆç±»å‹æœ‰è‡ªå·±çš„å®ä¾‹æ–¹æ³•è¿›è¡Œæ“ä½œ
3. å¦‚æœéœ€è¦ä½¿ç”¨ Reflect æ“ä½œ Mapï¼Œå¯ä»¥ï¼š
    - é€šè¿‡ Reflect.apply è°ƒç”¨ `Map çš„åŸå‹æ–¹æ³•`
    - ä½¿ç”¨ `Proxy` ä»£ç† Map çš„æ“ä½œ

## 3. ä»£ç æ‰§è¡Œ

```javascript hl:11
Promise.reject(1)
  .then(
    (res) => {
      console.log(2, res);
    },
    (err) => {
      console.log(3, err);
    },
  )
  .catch((err) => {
    // è¿™é‡Œä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºå‰é¢å·²ç»æœ‰äº†é”™è¯¯å¤„ç†
    console.log(4, err);
  });

```

## 4. å¦‚ä½•æŠŠä¸€ä¸ªå¯¹è±¡å˜æˆå¯è¿­ä»£å¯¹è±¡

![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-7.png)

## 5. å¦‚ä½•åœ¨ Canvas è·å–è·¨åŸŸçš„å›¾ç‰‡

![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-8.png)

å½“ç„¶ï¼Œéœ€è¦è®¾ç½®å›¾ç‰‡çš„å“åº”å¤´ï¼Œå…è®¸è·¨åŸŸ

## 6. WebSocket åè®®æœ¬èº«æ˜¯æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„

### 6.1. å®šä¹‰

1. WebSocket æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€å®Œæ•´çš„åè®®ï¼Œä¸ HTTP åè®®æ˜¯å¹³è¡Œçš„å…³ç³»ã€‚è™½ç„¶ WebSocket è¿æ¥çš„å»ºç«‹éœ€è¦ä¾èµ– HTTP åè®®è¿›è¡Œä¸€æ¬¡æ¡æ‰‹ï¼ˆupgradeï¼‰ï¼Œä½†æ˜¯ä¸€æ—¦ WebSocket è¿æ¥å»ºç«‹æˆåŠŸåï¼Œåç»­çš„æ•°æ®ä¼ è¾“å°±ä¸ HTTP æ— å…³äº†ã€‚
2. æµè§ˆå™¨åœ¨å®ç° WebSocket åè®®æ—¶ï¼Œé»˜è®¤å°±æ˜¯å…è®¸è·¨åŸŸçš„ã€‚è¿™æ„å‘³ç€ï¼š
	- ä½ å¯ä»¥ä»ä»»ä½•åŸŸåä¸‹çš„é¡µé¢è¿æ¥åˆ°ä»»ä½•æœåŠ¡å™¨çš„ WebSocket æœåŠ¡
	- ä¸éœ€è¦åƒ HTTP è¯·æ±‚é‚£æ ·é…ç½® CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ç›¸å…³çš„å¤´éƒ¨

### 6.2. æ¡æ‰‹é˜¶æ®µçš„é™åˆ¶

- åœ¨ WebSocket è¿æ¥å»ºç«‹æ—¶çš„ HTTP æ¡æ‰‹é˜¶æ®µï¼Œæµè§ˆå™¨ä¼šå‘é€ Origin å¤´éƒ¨
- æœåŠ¡å™¨å¯ä»¥é€šè¿‡æ£€æŸ¥ Origin å¤´éƒ¨æ¥å†³å®šæ˜¯å¦å…è®¸è¿æ¥
- è¿™æ˜¯ä¸€ç§æœåŠ¡å™¨ç«¯çš„å®‰å…¨æœºåˆ¶ï¼Œè€Œä¸æ˜¯æµè§ˆå™¨çš„è·¨åŸŸé™åˆ¶

### 6.3. æœ€ä½³å®è·µ
   ```javascript
   // å®¢æˆ·ç«¯ä»£ç ç¤ºä¾‹
   const ws = new WebSocket('ws://example.com/socketserver');
   
   // æœåŠ¡å™¨ç«¯å¯ä»¥æ£€æŸ¥ Originï¼ˆä»¥ Node.js ä¸ºä¾‹ï¼‰
   wss.on('connection', function connection(ws, request) {
     const origin = request.headers.origin;
     if (origin !== 'https://trusted-site.com') {
       ws.close();
       return;
     }
     // å¤„ç†æ­£å¸¸è¿æ¥...
   });
   ```

### 6.4. å®‰å…¨è€ƒè™‘
   - è™½ç„¶ WebSocket æ²¡æœ‰è·¨åŸŸé™åˆ¶ï¼Œä½†å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œ**æœåŠ¡å™¨ç«¯åº”è¯¥å®ç°è‡ªå·±çš„éªŒè¯æœºåˆ¶**
   - å¯ä»¥é€šè¿‡ tokenã€session ç­‰æ–¹å¼è¿›è¡Œèº«ä»½éªŒè¯
   - å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ WSSï¼ˆWebSocket Secureï¼‰åè®®ï¼Œå³åŸºäº SSL/TLS çš„å®‰å…¨ WebSocket è¿æ¥

### 6.5. æ€»ç»“

WebSocket åè®®æœ¬èº«ä¸å—æµè§ˆå™¨åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œå¯ä»¥è‡ªç”±åœ°è¿›è¡Œè·¨åŸŸé€šä¿¡ã€‚ä½†ä¸ºäº†å®‰å…¨æ€§ï¼ŒæœåŠ¡å™¨ç«¯åº”è¯¥å®ç°é€‚å½“çš„éªŒè¯æœºåˆ¶æ¥æ§åˆ¶è¿æ¥æƒé™ã€‚

## 7. åœ¨ JavaScript ä¸­è·å–å­—ç¬¦ä¸²çš„å­—èŠ‚é•¿åº¦ï¼Œå°¤å…¶æ˜¯è¦æ”¯æŒè¡¨æƒ…ç¬¦å·ï¼ˆemojiï¼‰

### 7.1. ä½¿ç”¨ Blob å¯¹è±¡ï¼ˆæœ€ç®€å•æ¨èçš„æ–¹å¼ï¼‰

```javascript hl:3,2
function getByteLength(str) {
    // åˆ›å»ºä¸€ä¸ª Blob å¯¹è±¡ï¼Œå¹¶æŒ‡å®šç¼–ç ä¸º UTF-8
    const blob = new Blob([str], { type: 'text/plain' });
    return blob.size;
}

// æµ‹è¯•
console.log(getByteLength('hello')); // 5
console.log(getByteLength('ä½ å¥½')); // 6
console.log(getByteLength('ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦')); // 25
console.log(getByteLength('ğŸŒ')); // 4
```

### 7.2. ä½¿ç”¨ TextEncoderï¼ˆç°ä»£æµè§ˆå™¨æ¨èï¼‰

```javascript
function getByteLength(str) {
    return new TextEncoder().encode(str).length;
}

// æµ‹è¯•
console.log(getByteLength('hello')); // 5
console.log(getByteLength('ä½ å¥½')); // 6
console.log(getByteLength('ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦')); // 25
console.log(getByteLength('ğŸŒ')); // 4
```

### 7.3. æ‰‹åŠ¨è®¡ç®—ï¼ˆå…¼å®¹æ€§æœ€å¥½ï¼Œä½†ä¸æ¨èï¼‰

```javascript
function getByteLength(str) {
    let length = 0;
    for (let i = 0; i < str.length; i++) {
        const code = str.charCodeAt(i);
        if (code <= 0x7f) {
            length += 1;
        } else if (code <= 0x7ff) {
            length += 2;
        } else if (code <= 0xffff) {
            length += 3;
        } else {
            length += 4;
        }
    }
    return length;
}

// æ³¨æ„ï¼šè¿™ç§æ–¹æ³•å¯¹äºæŸäº›ç‰¹æ®Šçš„emojiå¯èƒ½ä¸å¤Ÿå‡†ç¡®
```

### 7.4. å®Œæ•´çš„æµ‹è¯•ç¤ºä¾‹
```javascript
function compareByteLength() {
    const testStrings = [
        'hello',                    // æ™®é€šè‹±æ–‡
        'ä½ å¥½',                     // ä¸­æ–‡
        'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',                      // å¤æ‚emojiï¼ˆå®¶åº­ï¼‰
        'ğŸŒ',                       // ç®€å•emoji
        'ä½ å¥½ğŸ‘‹world',              // æ··åˆå­—ç¬¦ä¸²
        'â¤ï¸',                       // ç‰¹æ®Šemoji
        'ğŸ³ï¸â€ğŸŒˆ'                     // å½©è™¹æ——emoji
    ];

    const methods = {
        'Blobæ–¹æ³•': str => new Blob([str]).size,
        'TextEncoderæ–¹æ³•': str => new TextEncoder().encode(str).length
    };

    console.log('å­—ç¬¦ä¸²\t\tå­—ç¬¦é•¿åº¦\tBlobå­—èŠ‚\tEncoderå­—èŠ‚');
    console.log('----------------------------------------');

    testStrings.forEach(str => {
        console.log(
            `${str}\t\t` +
            `${str.length}\t\t` +
            `${methods['Blobæ–¹æ³•'](str)}\t\t` +
            `${methods['TextEncoderæ–¹æ³•'](str)}`
        );
    });
}

compareByteLength();
```

### 7.5. é‡è¦è¯´æ˜

#### 7.5.1. **ç¼–ç è¯´æ˜**

   - ä»¥ä¸Šæ–¹æ³•éƒ½æ˜¯åŸºäº UTF-8 ç¼–ç è®¡ç®—å­—èŠ‚é•¿åº¦
   - UTF-8 æ˜¯ä¸€ç§å˜é•¿ç¼–ç ï¼š
     - ASCII å­—ç¬¦å  1 å­—èŠ‚
     - ä¸­æ–‡å­—ç¬¦é€šå¸¸å  3 å­—èŠ‚
     - emoji å¯èƒ½å  4 å­—èŠ‚æˆ–æ›´å¤š

#### 7.5.2. **æ–¹æ³•é€‰æ‹©å»ºè®®**

   - ä¼˜å…ˆä½¿ç”¨ `TextEncoder`ï¼Œå®ƒæ˜¯ä¸“é—¨ç”¨äºå¤„ç†æ–‡æœ¬ç¼–ç çš„æ ‡å‡† API
   - å¦‚æœéœ€è¦è€ƒè™‘å…¼å®¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨ `Blob` æ–¹æ³•
   - é¿å…ä½¿ç”¨æ‰‹åŠ¨è®¡ç®—çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒå¯èƒ½åœ¨å¤„ç†æŸäº›ç‰¹æ®Šå­—ç¬¦æ—¶ä¸å¤Ÿå‡†ç¡®

#### 7.5.3. **æ³¨æ„äº‹é¡¹**

   - æŸäº›å¤æ‚çš„ emojiï¼ˆå¦‚å®¶åº­ emojiï¼‰å®é™…ä¸Šæ˜¯å¤šä¸ª emoji ç»„åˆè€Œæˆçš„
   - æŸäº› emoji å¯èƒ½åŒ…å«å˜ä½“é€‰æ‹©ç¬¦ï¼ˆVS16ï¼‰ç­‰ç‰¹æ®Šå­—ç¬¦
   - åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå»ºè®®æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•å¹¶è¿›è¡Œå……åˆ†æµ‹è¯•

#### 7.5.4. **æµè§ˆå™¨å…¼å®¹æ€§**

   - `TextEncoder`: ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ
   - `Blob`: IE10+ éƒ½æ”¯æŒ
   - æ‰‹åŠ¨è®¡ç®—æ–¹æ³•: æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼Œä½†å‡†ç¡®æ€§å¯èƒ½æœ‰é™

## 8. Mapã€WeakMapã€Object çš„åŒºåˆ«

![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-9.png)

## 9. pnpmï¼ˆperformant npmï¼‰åŒ…ç®¡ç†å™¨  çš„ä¸»è¦ç‰¹ç‚¹å’Œä¼˜åŠ¿

### 9.1. é«˜æ•ˆçš„ç£ç›˜ç©ºé—´åˆ©ç”¨

pnpm ä½¿ç”¨`ç¡¬é“¾æ¥å’Œç¬¦å·é“¾æ¥`æ¥å…±äº«é¡¹ç›®é—´çš„ä¾èµ–ï¼Œè¿™æ„å‘³ç€ï¼š

- ç›¸åŒçš„ä¾èµ–åŒ…åªä¼šåœ¨ç£ç›˜ä¸Šå­˜å‚¨ä¸€æ¬¡
- å¤§å¤§å‡å°‘äº†ç£ç›˜ç©ºé—´çš„ä½¿ç”¨
- å®‰è£…é€Ÿåº¦æ›´å¿«ï¼Œå› ä¸ºè®¸å¤šåŒ…å¯èƒ½å·²ç»å­˜åœ¨äºå…¨å±€å­˜å‚¨ä¸­

```
.pnpm-store/
  |-- node_modules/
      |-- packageA@1.0.0
      |-- packageB@2.0.0
      ...
```

### 9.2. ä¸¥æ ¼çš„ä¾èµ–ç»“æ„

pnpm åˆ›å»ºäº†ä¸€ä¸ª**éå¹³é“º**çš„ `node_modules` ç»“æ„ï¼š

- æ¯ä¸ªåŒ…åªèƒ½è®¿é—®å…¶ç›´æ¥ä¾èµ–
- é˜²æ­¢ä¾èµ–æå‡ï¼Œé¿å…"å¹½çµä¾èµ–"é—®é¢˜
- æé«˜äº†é¡¹ç›®çš„å¯é¢„æµ‹æ€§å’Œå®‰å…¨æ€§

``` hl:2
node_modules/
  |-- .pnpm/
      |-- packageA@1.0.0/
      |-- packageB@2.0.0/
  |-- packageA -> .pnpm/packageA@1.0.0/node_modules/packageA
  |-- packageB -> .pnpm/packageB@2.0.0/node_modules/packageB
```

### 9.3. å¿«é€Ÿå®‰è£…

- å¹¶è¡Œå®‰è£…å¤šä¸ªåŒ…
- åˆ©ç”¨ç¼“å­˜å’Œç¡¬é“¾æ¥ï¼Œå‡å°‘ç½‘ç»œå’Œç£ç›˜ I/O

### 9.4. æ”¯æŒ monorepo

pnpm å†…ç½®äº†å¯¹ monorepoï¼ˆå•ä»“å¤šåŒ…ï¼‰é¡¹ç›®çš„æ”¯æŒï¼š

- ä½¿ç”¨ `pnpm-workspace.yaml` å®šä¹‰å·¥ä½œç©ºé—´
- æä¾› `pnpm add -w` å‘½ä»¤æ¥å®‰è£…æ ¹ä¾èµ–
- æ”¯æŒ `--filter` å‚æ•°æ¥æ“ä½œç‰¹å®šçš„åŒ…

### 9.5. å…¼å®¹æ€§

- ä¸ npm å’Œ Yarn çš„ `package.json` æ ¼å¼å®Œå…¨å…¼å®¹
- å¯ä»¥ç›´æ¥æ›¿æ¢ç°æœ‰çš„ npm æˆ– Yarn é¡¹ç›®

### 9.6. å…¶ä»–ç‰¹æ€§

- å†…ç½®å¯¹ Node.js ç‰ˆæœ¬ç®¡ç†çš„æ”¯æŒ
- æ”¯æŒæ’ä»¶ç³»ç»Ÿ
- æä¾›äº†è®¸å¤šæœ‰ç”¨çš„å‘½ä»¤ï¼Œå¦‚ `pnpm why` ç”¨äºåˆ†æä¾èµ–å…³ç³»

### 9.7. ä½¿ç”¨ç¤ºä¾‹

```bash
# å®‰è£…ä¾èµ–
pnpm install

# æ·»åŠ ä¾èµ–
pnpm add react

# è¿è¡Œè„šæœ¬
pnpm run build

# åœ¨å·¥ä½œç©ºé—´ä¸­æ·»åŠ ä¾èµ–
pnpm add -w typescript

# åœ¨ç‰¹å®šåŒ…ä¸­æ·»åŠ ä¾èµ–
pnpm add lodash --filter package-name
```

### 9.8. pnpm.lock æ–‡ä»¶

pnpm ä½¿ç”¨ `pnpm-lock.yaml` æ–‡ä»¶æ¥é”å®šä¾èµ–ç‰ˆæœ¬ï¼Œç¡®ä¿å›¢é˜Ÿæˆå‘˜å’Œ CI ç¯å¢ƒä½¿ç”¨ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ã€‚

### 9.9. æ€§èƒ½å¯¹æ¯”

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œpnpm çš„å®‰è£…é€Ÿåº¦æ¯” npm å’Œ Yarn å¿«ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§å‹é¡¹ç›®æˆ– monorepo æ—¶ã€‚

## 10. å¦‚ä½•åˆ¤æ–­æ˜¯ PC è¿˜æ˜¯ç§»åŠ¨ç«¯

- ua
- touch äº‹ä»¶æ˜¯å¦åœ¨ documentä¸­
- æ¨ªç«–å±å¹•
- ç‰¹å®šå±æ€§ï¼Œæ¯”å¦‚é€šè¿‡ js åˆ¤æ–­åª’ä½“æŸ¥è¯¢æ˜¯å¦ç”Ÿæ•ˆ
- æœ€å¥½è¿˜æ˜¯ä½¿ç”¨ä¸‰æ–¹å·¥å…·åŒ…
- ç­‰ç­‰

## 11. js å¦‚ä½•åŠ¨æ€ç”Ÿæˆæµ·æŠ¥

- dom - canvas - image
- dom - svg - canvas  - image
- nodejs è°ƒç”¨ pupper æ— å¤´æµè§ˆå™¨

## 12. å¦‚ä½•é¡ºåºæ‰§è¡Œ 10 ä¸ªä»»åŠ¡

- æ–¹æ³•ä¸€ï¼šfor/for-of  - await
- æ–¹æ³•äºŒï¼šreduce
	- prev task
	- current task

## 13. åˆå¹¶è¿ç»­çš„æ•°å­—

éå† +  ä¸´æ—¶å˜é‡

![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-10.png)

## 14. å¦‚ä½•è§£å†³ promise.all æœ‰ä¸€ä¸ªä»»åŠ¡æŠ¥é”™äº†ï¼Œå…¶ä»–ä»»åŠ¡ç»“æœéƒ½æŠ›å¼ƒäº†ï¼Ÿ

- æ–¹æ¡ˆä¸€ï¼špromise.allSetteled
- æ–¹æ¡ˆäºŒï¼šå®¹é”™ä¸‹ï¼Œåˆ«è®© promise æŠ¥é”™
- æ–¹æ¡ˆä¸‰ï¼š
	- ![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-11.png)

## 15. `["1", "2", "3"].map(parseInt)`

### 15.1. åˆ†æ

```javascript hl:8,14,15
["1", "2", "3"].map(parseInt);

// ==> 1, NaN, NaN
// parseInt() å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯è¦è¢«è§£æçš„å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªæ˜¯è¿›åˆ¶æ•°ã€‚
// map() æ–¹æ³•ä¼šç»™å›è°ƒå‡½æ•°ä¼ é€’ä¸‰ä¸ªå‚æ•°ï¼šå½“å‰å…ƒç´ ã€å½“å‰ç´¢å¼•ã€æ•´ä¸ªæ•°ç»„ã€‚

// parseInt("1", 0, ["1", "2", "3"]); // 1 ï¼Œ 0è¿›åˆ¶ï¼Œè‡ªåŠ¨åˆ¤æ–­
// // ç¬¬äºŒä¸ªå‚æ•°ä¼  0 çš„è§„åˆ™ï¼š
// 1. å¦‚æœå­—ç¬¦ä¸²ä»¥ "0x" æˆ– "0X" å¼€å¤´ï¼ŒæŒ‰ 16 è¿›åˆ¶è§£æ
// 2. åœ¨ç°ä»£ JavaScriptï¼ˆES5+ï¼‰ä¸­ï¼Œå…¶ä»–æƒ…å†µä¸€å¾‹æŒ‰ 10 è¿›åˆ¶è§£æ
// 3. åœ¨è€ç‰ˆæœ¬ JavaScript ä¸­ï¼Œå¦‚æœå­—ç¬¦ä¸²ä»¥ "0" å¼€å¤´ï¼Œä¼šæŒ‰ 8 è¿›åˆ¶è§£æ
// 4. å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸æ˜¯ä¸€ä¸ªæ•°å€¼ï¼Œä¼šæŒ‰ 10 è¿›åˆ¶è§£æï¼Œå’Œä¸ä¼ ç¬¬äºŒä¸ªå‚æ•°ä¸€æ ·

// parseInt("2", 1, ["1", "2", "3"]); // NaN, æ²¡æœ‰1è¿›åˆ¶ï¼Œå¿…é¡»å–å€¼èŒƒå›´åœ¨2-36ä¹‹é—´
// parseInt("3", 2, ["1", "2", "3"]); // NaN ï¼Œ3ä¸æ˜¯2è¿›åˆ¶æ•°

```

### 15.2. å…³äº parseInt çš„ç¬¬äºŒä¸ªå‚æ•°

```javascript hl:1,13
// è¿›åˆ¶å¿…é¡»åœ¨ 2-36 ä¹‹é—´
console.log(parseInt("123", 1));    // NaN
console.log(parseInt("123", 37));   // NaN

// ä¸åŒè¿›åˆ¶çš„è§£æ
console.log(parseInt("100", 2)); // 4 (äºŒè¿›åˆ¶)
console.log(parseInt("100", 8)); // 64 (å…«è¿›åˆ¶)
console.log(parseInt("100", 10)); // 100 (åè¿›åˆ¶)
console.log(parseInt("100", 16)); // 256 (åå…­è¿›åˆ¶)

// ä¸åŒè¿›åˆ¶ä¸‹çš„ç›¸åŒå­—ç¬¦ä¸²å¯èƒ½å¾—åˆ°ä¸åŒç»“æœ
console.log(parseInt("19", 10)); // 19 (åè¿›åˆ¶)
console.log(parseInt("19", 8)); // 1 (å…«è¿›åˆ¶ï¼Œ9ä¸æ˜¯æœ‰æ•ˆçš„å…«è¿›åˆ¶æ•°å­—)
```

## 16. å‡½æ•°ä½¿ç”¨ `bind`è¿ç»­ç»‘å®šå¤šæ¬¡ï¼Œåé¢ç»‘å®šçš„éƒ½æ— æ•ˆ

![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-12.png)

## 17. new fn ä¸ new fn() çš„åŒºåˆ«

![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-13.png)

## 18. ajax  fetch axios

- ajax
	- åŸºäº  XHR å¯¹è±¡
- fetch 
	- æ²¡æœ‰åŸºäº XHRï¼Œä¸æ˜¯å¯¹ XHRçš„è¿›ä¸€æ­¥å°è£…
	- ä½¿ç”¨çš„åŸç”Ÿçš„ js 
	- åŸºäº Promise
-  axios
	- æµè§ˆå™¨ï¼šåŸºäº XHR
	- nodejsï¼šåŸºäº http æ¨¡å—
	- å…¶ä»–çš„åŒ…è£…æ¯”å¦‚ promise
	- å®‰å…¨æœºåˆ¶

## 19. æµè§ˆå™¨çš„è·¨æ ‡ç­¾é¡µï¼ˆCross-tabï¼‰é€šä¿¡

### 19.1. é—®é¢˜ï¼šä¸åŒçš„Tabï¼Œä¸åŒçš„åŸŸåï¼Œä¸€ä¸ª Tab ä¸‹é¢çš„é¡µé¢ä½¿ç”¨ postMessageï¼Œå¦å¤–ä¸€ä¸ª Tab ç›‘å¬ message èƒ½å¤Ÿç›‘å¬å¾—åˆ°å—ï¼Ÿ

- ä¸åŒçš„ Tabï¼Œä¸åŒçš„åŸŸå
	- å½“ä¸¤ä¸ªæ ‡ç­¾é¡µå±äºä¸åŒçš„åŸŸåæ—¶ï¼Œå®ƒä»¬æ˜¯è¿è¡Œåœ¨å®Œå…¨éš”ç¦»çš„ä¸Šä¸‹æ–‡ä¸­çš„ã€‚è¿™æ˜¯ç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰æ‰€å¯¼è‡´çš„å®‰å…¨é™åˆ¶ã€‚
- postMessage å’Œ message äº‹ä»¶
	- postMessage æ–¹æ³•æ˜¯ä¸€ç§å®‰å…¨çš„è·¨æºé€šä¿¡æ–¹å¼ï¼Œè€Œ message äº‹ä»¶ç”¨äºæ¥æ”¶é€šè¿‡ postMessage å‘é€çš„æ¶ˆæ¯ã€‚
- èƒ½å¦ç›‘å¬åˆ°ï¼Ÿ
	- åœ¨ä½ æè¿°çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ª Tab ä¸‹çš„é¡µé¢ä½¿ç”¨ postMessageï¼Œå¦ä¸€ä¸ª Tab ç›‘å¬ message äº‹ä»¶ï¼Œ**é€šå¸¸æƒ…å†µä¸‹æ˜¯æ— æ³•ç›‘å¬åˆ°çš„**ã€‚

 åŸå› å¦‚ä¸‹ï¼š
1. **çª—å£å¼•ç”¨é—®é¢˜**ï¼špostMessage éœ€è¦ä¸€ä¸ªç›®æ ‡çª—å£çš„å¼•ç”¨ã€‚ä¸åŒ Tab ä¹‹é—´é»˜è®¤æ˜¯æ²¡æœ‰è¿™ç§å¼•ç”¨çš„ã€‚æ¯”å¦‚ä½¿ç”¨ `window.open`
2. **åŸŸåä¸åŒ**ï¼š**å³ä½¿æœ‰çª—å£å¼•ç”¨**ï¼Œä¸åŒåŸŸåä¹‹é—´çš„é€šä¿¡ä¹Ÿéœ€è¦æ˜ç¡®æŒ‡å®šç›®æ ‡æºã€‚
3. **äº‹ä»¶ä¼ æ’­èŒƒå›´**ï¼šmessage äº‹ä»¶é€šå¸¸åªåœ¨ç›®æ ‡çª—å£å†…ä¼ æ’­ï¼Œä¸ä¼šè·¨è¶Šåˆ°å…¶ä»–æœªç›¸å…³çš„æ ‡ç­¾é¡µã€‚


### 19.2. å®‰å…¨ç­–ç•¥

- å¦‚æœä½ ä¸éœ€è¦æ¥å—å…¶ä»–ç½‘ç«™çš„messageï¼Œè¯·ä¸è¦ç›‘å¬ message äº‹ä»¶
- å³ä½¿ç›‘å¬ï¼Œè¯·åŠ¡å¿…å¤‡æ³¨ origin å’Œ source æ¥éªŒè¯å‘ä»¶äººçš„èº«ä»½

### 19.3. æœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µå’Œè§£å†³æ–¹æ¡ˆ

1. **opener å…³ç³»**ï¼šå¦‚æœä¸€ä¸ªæ ‡ç­¾é¡µæ˜¯ç”±å¦ä¸€ä¸ªæ ‡ç­¾é¡µæ‰“å¼€çš„ï¼ˆä½¿ç”¨ window.open()ï¼‰ï¼Œåˆ™å®ƒä»¬ä¹‹é—´å¯ä»¥é€šè¿‡ opener å’Œ postMessage è¿›è¡Œé€šä¿¡ã€‚
2. **å…±äº«å­˜å‚¨**ï¼šå¯ä»¥ä½¿ç”¨ localStorage æˆ– IndexedDB ç­‰å…±äº«å­˜å‚¨æ–¹å¼ï¼Œé…åˆ storage äº‹ä»¶æ¥å®ç°è·¨æ ‡ç­¾é¡µé€šä¿¡ã€‚
3. **Broadcast Channel API**ï¼šè¿™æ˜¯ä¸€ä¸ªè¾ƒæ–°çš„ APIï¼Œå…è®¸**åŒæºçš„ä¸åŒä¸Šä¸‹æ–‡**ï¼ˆå¦‚ä¸åŒçš„æ ‡ç­¾é¡µï¼‰ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚
4. **Service Worker**ï¼šå¯ä»¥ä½¿ç”¨ Service Worker ä½œä¸ºä¸­é—´äººæ¥åè°ƒä¸åŒæ ‡ç­¾é¡µä¹‹é—´çš„é€šä¿¡ã€‚
5. **WebSocket**ï¼šå¯ä»¥é€šè¿‡æœåŠ¡å™¨ç«¯çš„ WebSocket è¿æ¥æ¥åè°ƒä¸åŒæ ‡ç­¾é¡µä¹‹é—´çš„é€šä¿¡ã€‚

## 20. ç»™ä¸€ä¸ª DOM å…ƒç´ ç»‘å®šå¤šæ¬¡ clickï¼Œä¸€ä¸ªæ•è·ï¼Œä¸€ä¸ªå†’æ³¡ï¼Œå¦‚ä½•æ‰§è¡Œï¼Ÿ

- ç»‘å®šå¤šå°‘æ¬¡å°±æ‰§è¡Œå¤šå°‘æ¬¡
- å…ˆæ•è·ï¼Œåå†’æ³¡

## 21. å¦‚ä½•è·å–ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡

- `æ„é€ å‡½æ•°.prototype`
- `å®ä¾‹å¯¹è±¡.__proto__`
- `Object.getProtoTypeof(å¯¹è±¡å®ä¾‹)`

## 22. ç§»åŠ¨ç«¯é€‚é…åŸç†

æ¯”å¦‚ flexible.js  ä¸å±•å¼€äº†ï¼Œå’Œ rem ä¸€ä¸ªé“ç†

éœ€è¦æ³¨æ„çš„äº‹ï¼Œå¦‚ä½•åˆ¤æ–­æ˜¯å¦ `0.5`
- å¾ˆç®€å• `dpr >= 2` å³å¯


## 23. å¦‚ä½•å®ç° repeat å®ç°å­—ç¬¦ä¸²æ‹¼æ¥

```javascript hl:2,5,10
// æœ€ç®€å•ç›´æ¥çš„æ–¹æ³•
const str1 = "abc".repeat(3); // "abcabcabc"

const str2 = Array(4).join("abc"); // "abcabcabc"
// è§£é‡Šï¼šåˆ›å»ºé•¿åº¦ä¸º4çš„æ•°ç»„ï¼Œjoinä¼šæ‰§è¡Œ3æ¬¡ï¼Œæ‰€ä»¥é‡å¤3æ¬¡
// Array(4) åˆ›å»º [empty Ã— 4]
// join("abc") ä¼šåœ¨æ•°ç»„å…ƒç´ ä¹‹é—´æ’å…¥"abc"


const str3 = Array(3).fill("abc").join(""); // "abcabcabc"
// æˆ–è€…
const str3_2 = new Array(3).fill("abc").join("");

```


## 24. å®ç° mergePromise å‡½æ•°ï¼ŒæŠŠä¼ è¿›å»çš„æ•°ç»„æŒ‰é¡ºåºå…ˆåæ‰§è¡Œï¼Œå¹¶ä¸”æŠŠè¿”å›çš„æ•°æ®å…ˆåæ”¾åˆ°æ•°ç»„ data ä¸­

```javascript hl:10,17,25
// mergePromise å‡½æ•°ï¼ŒæŠŠä¼ è¿›å»çš„æ•°ç»„æŒ‰é¡ºåºå…ˆåæ‰§è¡Œï¼Œå¹¶ä¸”æŠŠè¿”å›çš„æ•°æ®å…ˆåæ”¾åˆ°æ•°ç»„ data ä¸­
mergePromise([ajax1, ajax2, ajax3]).then((data) => {
  console.log("done");
  console.log(data); // data ä¸º [1, 2, 3]
});

function mergePromise(arr) {
  // åœ¨è¿™é‡Œå†™ä»£ç 
  const data = [];
  let promise = Promise.resolve();
  // ä¾æ¬¡æ‰§è¡Œä¼ å…¥çš„å‡½æ•°
  // è¿™é‡Œçš„ promise.then æ˜¯ä¸ºäº†ä¿è¯é¡ºåºæ‰§è¡Œ
  arr.forEach((fn) => {
    // æ¯æ¬¡éå†æ—¶ï¼Œpromise éƒ½æ˜¯ä¸Šä¸€ä¸ª promise.then è¿”å›çš„ promise
    // ä½†æ˜¯ï¼Œè¿™é‡Œ promise ä¸ä¼šè¢«è¦†ç›–å—ï¼Ÿ
    // ä¸ä¼šï¼Œå› ä¸º promise.then è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„ promise
    promise = promise.then(fn).then((res) => {
      data.push(res);
      // è¿”å› res ä¿è¯ä¸‹ä¸€ä¸ª then ä¸­çš„ res æ˜¯ä¸Šä¸€ä¸ªçš„ç»“æœ
      return data;
    });
  });
}

// åŒºåˆ«äº Promise.allï¼ŒPromise.all æ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œè€Œè¿™é‡Œéœ€è¦ä¸²è¡Œæ‰§è¡Œ

```


## 25. Promise ç›¸å…³é—®é¢˜

### 25.1. finnalyï¼šæ— è®ºå¤±è´¥æˆ–è€…æˆåŠŸéƒ½ä¼šæ‰§è¡Œï¼Œä¸”æ¥å—ä¸åˆ°ç»“æœ

### 25.2. æ³¨æ„é¡ºåº

![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-14.png)

### 25.3. reject åŒ…åœ¨ try é‡Œé¢ä¹Ÿä¼šè¢«æ•è·åˆ°

```javascript hl:3,5
async function asyncl() {
  try {
    await Promise.reject("error!!!");
  } catch (e) {
    console.log(e); // ä¼šæ‰§è¡Œåˆ°
  }
}

asyncl();
```

#### 25.3.1. æ²¡æœ‰æ•è·ä¼šæŠ¥é”™

![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-15.png)

### 25.4. then å’Œ .catch è¿”å›çš„å€¼ä¸èƒ½ä½¿ promise å¯¹è±¡æœ¬èº«ï¼Œå¦åˆ™ä¼šæ­»å¾ªç¯

![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-16.png)



## 26. await æ²¡æŠ¥é”™å°±ä¼šå¾€ä¸‹èµ°ï¼Œåˆ«å’Œ promise ææ··äº†

![å›¾ç‰‡&æ–‡ä»¶](./files/20241112-18.png)


å› ä¸º å¦‚æœ async å‡½æ•°æ²¡æœ‰æ˜¾å¼çš„è¿”å›å€¼ï¼Œå®ƒä»ç„¶ä¼šè¿”å›ä¸€ä¸ª Promiseï¼Œå…·ä½“è¡Œä¸ºå¦‚ä¸‹ï¼š

```javascript
// æ²¡æœ‰ return è¯­å¥
async function noReturn() {
    console.log("Hello");
}
// ç­‰ä»·äºè¿”å› Promise<undefined>
console.log(noReturn()); // Promise {<fulfilled>: undefined}


// ç©º return è¯­å¥
async function emptyReturn() {
    console.log("Hello");
    return;
}
// åŒæ ·è¿”å› Promise<undefined>
console.log(emptyReturn()); // Promise {<fulfilled>: undefined}


// å³ä½¿å‡½æ•°ä½“ä¸ºç©º
async function empty() {}
console.log(empty()); // Promise {<fulfilled>: undefined}
```


### 26.1. ä¸‹é¢çš„ä»£ç å°±ä¸€ç›´ä¼š pengding ä½äº†

![472](#)